<!DOCTYPE html>
<html>
<head>
    <title>West GA Weather Radar</title>
    <link rel="icon" type="image/png" href="https://imgur.com/1yg7pPb.png">
    <meta charset="utf-8"/>
   <meta content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0" name="viewport">
    <meta property="og:title" content="West GA Weather Radar">
    <meta property="og:description" content="The official West GA Weather radar offers live alerts, watches, reports, customizable color schemes, satellite imagery, smoothing options, and much moreâ€”all for free.">
    <meta property="og:image" content="https://imgur.com/1yg7pPb.png">
  <link rel="preload" href="https://api.maptiler.com/maps/d3bdcfa3-d8d8-4bc1-958d-6d1780cb4de1/style.json?key=drXsj04WIDowwjjOrinL" as="fetch" crossorigin="anonymous">
<link rel="preload" href="https://api.maptiler.com/maps/3d1b9c2b-3b90-4457-8310-fbd15c34d453/style.json?key=HKGa1lnD7ToUuzx5Ohp0" as="fetch" crossorigin="anonymous">
<link rel="preload" href="https://api.maptiler.com/maps/645f642d-36b4-42d1-8b02-b9968eff3443/style.json?key=HKGa1lnD7ToUuzx5Ohp0" as="fetch" crossorigin="anonymous">
<link rel="preload" href="https://api.maptiler.com/maps/dd940e48-cc35-41f3-b8e6-3942e4a1f75b/style.json?key=HKGa1lnD7ToUuzx5Ohp0" as="fetch" crossorigin="anonymous">
    <link rel="preload" href="https://i.postimg.cc/6phc4hHF/IMG-4634-removebg-preview.webp" as="image">
    <link rel="preload" href="https://i.postimg.cc/TPR22TSn/IMG-4615-removebg-preview.webp" as="image">
    <link rel="preload" href="https://i.postimg.cc/4d2xFjWV/IMG-4613-removebg-preview.webp" as="image">
    <link rel="preload" href="https://i.postimg.cc/3JBc57gs/IMG-4607-removebg-preview.webp" as="image">
    <link rel="preload" href="https://i.postimg.cc/bJxRxHg7/IMG-4608-removebg-preview.webp" as="image">
    <link rel="preload" href="https://i.postimg.cc/K8C7CsHX/IMG-4610-removebg-preview-1.webp" as="image">
    <link rel="preload" href="https://i.postimg.cc/gcMZfTxM/IMG-4619-removebg-preview.webp" as="image">
    <link rel="preload" href="https://i.ibb.co/BLpDqjr/IMG-7262.png" as="image">
    <link rel="preload" href="https://i.ibb.co/HTgK74M/download-32.png" as="image">
    <link rel="preload" href="https://i.ibb.co/rd1xJLg/download-33.png" as="image">
    <link rel="preload" href="https://i.ibb.co/b29Tb0C/download-34.png" as="image">
    <link rel="preload" href="https://i.ibb.co/Fw0D7Ky/download-35.png" as="image">
    <link rel="preload" href="https://i.ibb.co/p2fBxNk/download-36.png" as="image">
    <link rel="preload" href="https://i.ibb.co/r2yj8cm/2.png" as="image">
    <link rel="preload" href="https://i.ibb.co/SPgBMTd/5-wind.png" as="image">
    <link rel="preload" href="https://i.postimg.cc/NF0xFHd6/10-tor.png" as="image">
    <link rel="preload" href="https://i.ibb.co/Vwbz2g1/IMG-7277-modified.png" as="image">
    <link rel="preload" href="https://i.ibb.co/qYjRDwM/30-tor.png" as="image">
    <link rel="preload" href="https://i.postimg.cc/BZhgymvM/45-tor.png" as="image">
    <link rel="preload" href="https://i.ibb.co/jD4gf2F/15-wind.png" as="image">
    <link rel="preload" href="https://i.ibb.co/L1hKKkp/IMG-7262-1.png" as="image">
    <link rel="preload" href="https://i.ibb.co/rpPKWXw/30-wind.png" as="image">
    <link rel="preload" href="https://i.ibb.co/dtkmMpp/45-wind.png" as="image">
    <link rel="preload" href="https://kit.fontawesome.com/7c0d120d1b.js" as="script" crossorigin="anonymous">
    <link rel="preload" href="https://kit.fontawesome.com/7c0d120d1b.css" as="style" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha384-k6RqeWeci5ZR/Lv4MR0sA0FfDOMY5tA5LUfUWzQcJdVPHfGl4Z4wUmkO9j/+zTYM" crossorigin="anonymous">

    <link rel="preload" href="https://i.postimg.cc/CMW0J24t/IMG-4612-removebg-preview-1.webp" as="image">
    <link rel="preload" href="https://i.postimg.cc/TPR22TSn/IMG-4615-removebg-preview.webp" as="image">
    <link rel="preload" href="https://i.ibb.co/vw43hWJ/Square-256x-20.png" as="image">
    
    <link rel="stylesheet" href="style.css">

    <style>
        /* Add these styles inline to ensure they take effect immediately */
        .menu-panel {
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        
        .menu-panel.active {
            display: block;
            opacity: 1;
        }
        
        /* Ensure submenus are hidden by default */
        #hurricane-settings,
        #outlooks-settings,
        #reports-settings,
        #map-settings,
        #radar-settings,
        #alerts-settings,
        #weather-radio-settings,
        #general-info,
        #updates-info,
        #attributions,
        #info-menu {
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        
        /* When active, show menus smoothly */
        .active {
            display: block !important;
            opacity: 1 !important;
        }
    </style>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2L4XKHE9RM"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-2L4XKHE9RM');
    </script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdn.maptiler.com/maptiler-sdk-js/v2.0.3/maptiler-sdk.umd.js"></script>
    <script src="https://unpkg.com/esri-leaflet/dist/esri-leaflet.js"></script>
    <link href="https://cdn.maptiler.com/maptiler-sdk-js/v2.0.3/maptiler-sdk.css" rel="stylesheet" />
    <script src="https://cdn.maptiler.com/leaflet-maptilersdk/v2.0.0/leaflet-maptilersdk.js"></script>
    <link href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" rel="stylesheet"/>
    <script src="https://kit.fontawesome.com/7c0d120d1b.js" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    
    <link rel="preload" href="https://cdn.maptiler.com/maptiler-sdk-js/v2.0.3/maptiler-sdk.css" as="style" crossorigin="anonymous">
    <link rel="preload" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" as="style">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" as="style">

    <link rel="preload" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" as="script">
    <link rel="preload" href="https://cdn.maptiler.com/maptiler-sdk-js/v2.0.3/maptiler-sdk.umd.js" as="script" crossorigin="anonymous">
    <link rel="preload" href="https://kit.fontawesome.com/7c0d120d1b.js" as="script" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/websocket/1.0.34/websocket.min.js"></script>
</head>

<!-- Control Bar at Bottom with Updated Margins and Button Sizes -->
<div id="control-bar">
    <ul style="list-style: none; padding: 0; margin: 0; display: flex; align-items: center;">
        <!-- Backward Button -->
        <li class="sli">
            <button class="control-button" onclick="stop(); showFrame(animationPosition - 1); return;">
                <i class="fa-solid fa-backward"></i>
            </button>
        </li>

        <!-- Play/Stop Button -->
        <li class="sli">
            <button class="control-button" onclick="playStop();" id="stbtn">
                <i class="fa-solid fa-play"></i>
            </button>
        </li>

        <!-- Forward Button -->
        <li class="sli">
            <button class="control-button" onclick="stop(); showFrame(animationPosition + 1); return;">
                <i class="fa-solid fa-forward"></i>
            </button>
        </li>

        <!-- Refresh Radar Button -->
        <li class="sli">
            <button class="control-button" onclick="refreshRadar();">
                <i class="fa-solid fa-refresh"></i>
            </button>
        </li>

        <!-- Layers Button -->
        <li class="sli">
            <button id="layers-button" class="control-button" onclick="toggleMainMenu('layers-menu');">
                <i class="fa-solid fa-layer-group"></i>
            </button>
        </li>

        <!-- Spotters Button -->
        <li class="sli">
            <button id="spotter-button" class="control-button" onclick="toggleSpotters();" title="Toggle Storm Spotters">
                <i class="fa-solid fa-binoculars"></i>
            </button>
        </li>

        <!-- Info Button -->
        <li class="sli">
            <button id="info-button" class="control-button" onclick="toggleMainMenu('info-menu')">
                <i class="fa-solid fa-info-circle"></i>
            </button>
        </li>
    </ul>
</div>


    <div style="position: absolute; left: 50%; top: 30px;">
        <div class="overlay-object overlay-border" id="timestamp" style="cursor: default; text-align:center; position: relative; left: -50%;">Loading...</div>
    </div>

<!-- Hurricane Settings Submenu -->
<div id="hurricane-settings">
    <div class="menu-header">
        <button class="back-button" style="width: 40px;" onclick="toggleMainMenu('layers-menu');">
            <i class="fa-solid fa-chevron-left"></i>
        </button>
        <button class="exit-button" style="width: 40px;" onclick="toggleMainMenu('');">
            <i class="fa-solid fa-times"></i>
        </button>
    </div>
    <div style="margin-top: 10px;">
        <p class="settings-title"><b>Hurricane Settings</b></p>
        <button id="toggle-hurricanes" style="margin-bottom: 5px;" class="submenu-button" onclick="toggleHurricanes();">
            <i class="fa-solid fa-hurricane"></i> Toggle Hurricanes
        </button>
      

        <!-- New Toggle Disturbances Button -->
        <button id="toggle-disturbances" class="submenu-button" onclick="toggleInvests();">
            <i class="fa-solid fa-wind"></i> Toggle Disturbances
        </button>
         <p>Toggle the display of hurricane tracks and data on the map.</p>
    </div>
</div>


<div id="layers-menu" class="menu-panel">
    <div class="menu-header">
        <h2>Layers</h2>
        <button class="exit-button" onclick="toggleMainMenu('');">
            <i class="fa-solid fa-times"></i>
        </button>
    </div>
    <button class="menu-button" onclick="toggleSubMenu('map-settings')">
        <i class="fas fa-map"></i> Map Settings
    </button>
    <button class="menu-button" onclick="toggleSubMenu('radar-settings')">
        <i class="fas fa-radar"></i> Radar Settings
    </button>
    <button class="menu-button" onclick="toggleSubMenu('alerts-settings')">
        <i class="fas fa-bell"></i> Alert Settings
    </button>
    <button class="menu-button" onclick="toggleSubMenu('placefile-settings')">
        <i class="fas fa-file"></i> Placefile Settings
    </button>
</div>

<!-- Placefile Settings Submenu -->
<div id="placefile-settings">
    <div class="menu-header">
        <button class="back-button" style="width: 40px;" onclick="toggleMainMenu('layers-menu');">
            <i class="fa-solid fa-chevron-left"></i>
        </button>
        <button class="exit-button" style="width: 40px;" onclick="toggleMainMenu('');">
            <i class="fa-solid fa-times"></i>
        </button>
    </div>
    <div style="margin-top: 10px;">
        <p class="settings-title"><b>Placefile Settings</b></p>
        <div class="placefile-input">
            <input type="text" id="placefile-url" placeholder="Enter placefile URL" style="width: 100%; padding: 8px; margin-bottom: 10px; border: 2px solid #636381; border-radius: 5px;">
            <button onclick="addPlacefile();" style="font-size: 16px; background-color: white; color: #7F1DF0; border: 2px solid #636381; border-radius: 10px; width: 100%;">
                <i class="fa-solid fa-plus"></i> Add Placefile
            </button>
        </div>
        <div id="placefile-list" style="margin-top: 15px;">
            <!-- Active placefiles will be listed here -->
        </div>
        <p style="font-size: 14px; margin-top: 15px;">Enter a placefile URL to add custom overlays to the map. Supports GR Level 3 compatible placefiles.</p>
    </div>
</div>

<div id="outlooks-settings">
    <div class="menu-header">
        <button class="back-button" style="width: 40px;" onclick="toggleMainMenu('layers-menu');">
            <i class="fa-solid fa-chevron-left"></i>
        </button>
        <button class="exit-button" style="width: 40px;" onclick="toggleMainMenu('');">
            <i class="fa-solid fa-times"></i>
        </button>
    </div>
    <div style="margin-top: 10px;">
        <p class="settings-title"><b>Outlook Settings</b></p>
    </div>

<div class="outlook-group">
        <!-- Day 1 Outlooks -->
        <div class="outlook-selector">
            <b>Day 1:</b>
            <div>
                <input type="checkbox" id="convective_day1" name="outlook" onclick="updateOutlookType('day1', 'convective_day1');">
                <label for="convective_day1">Convective Outlook</label><br>
                <input type="checkbox" id="tornado_day1" name="outlook" onclick="updateOutlookType('day1', 'tornado_day1');">
                <label for="tornado_day1">Tornado Outlook</label><br>
                <input type="checkbox" id="wind_day1" name="outlook" onclick="updateOutlookType('day1', 'wind_day1');">
                <label for="wind_day1">Wind Outlook</label><br>
                <input type="checkbox" id="hail_day1" name="outlook" onclick="updateOutlookType('day1', 'hail_day1');">
                <label for="hail_day1">Hail Outlook</label>
            </div>
        </div>

        <!-- Spacer -->
        <div style="margin-top: 20px;"></div>

        <!-- Day 2 Outlooks -->
        <div class="outlook-selector">
            <b>Day 2:</b>
            <div>
                <input type="checkbox" id="convective_day2" name="outlook" onclick="updateOutlookType('day2', 'convective_day2');">
                <label for="convective_day2">Convective Outlook</label><br>
                <input type="checkbox" id="tornado_day2" name="outlook" onclick="updateOutlookType('day2', 'tornado_day2');">
                <label for="tornado_day2">Tornado Outlook</label><br>
                <input type="checkbox" id="wind_day2" name="outlook" onclick="updateOutlookType('day2', 'wind_day2');">
                <label for="wind_day2">Wind Outlook</label><br>
                <input type="checkbox" id="hail_day2" name="outlook" onclick="updateOutlookType('day2', 'hail_day2');">
                <label for="hail_day2">Hail Outlook</label>
            </div>
        </div>

        <!-- Spacer -->
        <div style="margin-top: 20px;"></div>

        <!-- Day 3 Outlooks -->
        <div class="outlook-selector">
            <b>Day 3:</b>
            <div>
                <input type="checkbox" id="convective_day3" name="outlook" onclick="updateOutlookType('day3', 'convective_day3');">
                <label for="convective_day3">Convective Outlook</label> 
            </div>
        </div>
    </div>
</div>

<!-- Report settings submenu -->
<div id="reports-settings">
    <div class="menu-header">
        <button class="back-button" style="width: 40px;" onclick="toggleMainMenu('layers-menu');"><i class="fa-solid fa-chevron-left"></i></button>
        <button class="exit-button" style="width: 40px;" onclick="toggleMainMenu('');"><i class="fa-solid fa-times"></i></button>
    </div>
    <div style="margin-top: 10px;">
        <p class="alert-settings-title"><b>Report Settings</b></p> <!-- Adjusted here -->
        <button id="togglereports" onclick="toggleReports();" style="font-size: 17px; background-color: white; color: #7F1DF0; border: #636381 2px solid;"><i class="fa-solid fa-flag"></i> Toggle Reports</button>
<p>Toggle the display of real-time storm reports on the map. Reports are automatically removed 2 hours after their initial appearance.  
</p>
    </div>
</div>

<!-- Map settings submenu -->
<div id="map-settings">
    <div class="menu-header">
        <button class="back-button" style="width: 40px;" onclick="toggleMainMenu('layers-menu');"><i class="fa-solid fa-chevron-left"></i></button>
        <button class="exit-button" style="width: 40px;" onclick="toggleMainMenu('');"><i class="fa-solid fa-times"></i></button>
    </div>
    <div style="margin-top: 0px;">
        <p class="settings-title"><b>Map Type</b></p>
        <label><input type="radio" name="map-type" value="light" onclick="setMapType('light')"> Light Mode</label><br>
        <label><input type="radio" name="map-type" value="dark" onclick="setMapType('dark')"> Dark Mode</label><br>
        <label><input type="radio" name="map-type" value="satellite" onclick="setMapType('satellite')"> Satellite</label>
    </div>
    <div id="location-settings-container" style="margin-top: 20px;">
        <p class="settings-title" style="text-align: left; padding-left: 2px;"><b>Location Settings</b></p>
        <button id="current-location-button" class="location-button" style="font-size: 17px; background-color: #636381; color: white; border: 2px solid white; margin-top: 5px;">
            <i class="fa-solid fa-location-arrow"></i> Show Location
        </button>
        <p style="font-size: 14px; color: #98FB98; display: flex; align-items: center; justify-content: center; margin-top: 10px;">
            <i class="fa-solid fa-shield-alt" style="color: #98FB98; font-size: 18px; margin-right: 5px;"></i>
            Location data is never saved.
        </p>
    </div>
</div>

 <div id="radar-settings">
    <div class="menu-header">
        <button class="back-button" onclick="toggleSubMenu('radar-settings', 'back')">
            <i class="fa-solid fa-chevron-left"></i>
        </button>
        <button class="exit-button" onclick="toggleMainMenu('')">
            <i class="fa-solid fa-times"></i>
        </button>
    </div>
    <div style="margin-top: 10px;">
        <p class="settings-title"><b>Radar Type</b></p>
        <label><input type="radio" name="radar-type" value="radar" checked onclick="setRadarType('radar')"> Radar</label>
        <label><input type="radio" name="radar-type" value="satellite" onclick="setRadarType('satellite')"> Infrared Satellite</label>
    </div>
    <div style="margin-top: 20px;">
        <p class="settings-title"><b>Radar Settings</b></p>

        <!-- Smoothing Button (First) -->
        <button id="smoothing-button" onclick="toggleSmoothing();" style="font-size: 16px; background-color: white; color: #7F1DF0; border: 2px solid #636381; border-radius: 10px;">
            <i class="fa-solid fa-wave-square"></i> Smoothing On
        </button>

        <!-- Animation Speed Button (Second) -->
        <button id="speed-button" onclick="toggleAnimationSpeed();" style="font-size: 16px; background-color: white; color: #7F1DF0; border: 2px solid #636381; border-radius: 10px;">
            <i class="fa-solid fa-forward"></i> Animation Speed: 1x
        </button>

        <!-- High Res / Low Res Button (Third) -->
        <button id="highres-button" onclick="toggleHighRes();" style="font-size: 16px; background-color: white; color: #7F1DF0; border: 2px solid #636381; border-radius: 10px;">
            <i class="fa-solid fa-highlighter"></i> Low Res Radar
        </button>

        <!-- Color Selection Dropdown (Styled to match buttons) -->
        <select id="colors" onchange="setColors();" style="font-size: 14px; background-color: white; color: #7F1DF0; border: 2px solid #636381; border-radius: 10px; font-family: 'Inter', sans-serif;">
            <option value="6">Original</option>
            <option value="1">Fruit</option>
            <option value="2">Universal Blue</option>
            <option value="3">TITAN</option>
            <option value="4">The Weather Channel</option>
            <option value="5">WeatherBug</option>
            <option value="8">Apple Weather</option>
            <option value="7">RAINBOW @ SELEX-SI</option>
            <option value="0">Black & White</option>
        </select>
    </div>
    <div style="margin-top: 20px;">
        <p class="settings-title"><b>Radar Opacity:</b></p>
        <input type="range" min="0" max="1" step="0.1" value="0.7" id="radar-opacity-slider" oninput="updateRadarOpacity(this.value)">
        <span id="radar-opacity-value">0.7</span>
    </div>
</div>


<div id="loading-screen">
    <div class="spinner"></div>
</div>



<!-- Alerts settings submenu -->
<div id="alerts-settings">
    <div class="menu-header">
        <button class="back-button" style="width: 40px;" onclick="toggleMainMenu('layers-menu');"><i class="fa-solid fa-chevron-left"></i></button>
        <button class="exit-button" style="width: 40px;" onclick="toggleMainMenu('');"><i class="fa-solid fa-times"></i></button>
    </div>
    <div style="margin-top: 10px;">
        <p class="alert-settings-title"><b>Alert Settings</b></p>
          <button id="refreshalerts" onclick="toggleAlerts();" style="font-size: 17px; background-color: white; color: #7F1DF0; border: #636381 2px solid;"><i class="fa-solid fa-triangle-exclamation"></i> Toggle Alerts</button>    
        <button id="togglewatches" onclick="toggleWatches();" style="font-size: 17px; background-color: white; color: #7F1DF0; border: #636381 2px solid;"><i class="fa-solid fa-eye"></i> Toggle Watches</button>
        <button id="togglediscussions" onclick="toggleDiscussions();" style="font-size: 17px; background-color: white; color: #7F1DF0; border: 2px solid #636381;"><i class="fa-solid fa-comments"></i> Toggle Discussions</button>
    </div>
    <div style="margin-top: 10px;">
        <p class="alert-settings-title"><b>Alert Fill Opacity:</b></p>
        <input type="range" min="0" max="1" step="0.1" value="0.4" id="alert-opacity-slider" oninput="updateAlertOpacity(this.value)">
        <span id="alert-opacity-value">0.4</span>
    </div>
</div>


    <!--Alert list submenu-->
    <div id="alert-list-submenu">
        <div class="menu-header">
            <button class="back-button" style="width: 40px;" onclick="toggleMainMenu('alerts-settings');"><i class="fa-solid fa-chevron-left"></i></button>
            <button class="exit-button" style="width: 40px;" onclick="toggleMainMenu('');"><i class="fa-solid fa-times"></i></button>
        </div>
        <div style="margin-top: 10px;" class="small-border">
            <p style="margin: 0; padding: 2px;"><b>Alert List:</b></p>
        </div>
    </div>
    
  <!-- Weather Radio Settings Submenu -->
<div id="weather-radio-settings">

    <div class="menu-header">
        <button class="back-button" style="width: 40px;" onclick="toggleMainMenu('layers-menu');">
            <i class="fa-solid fa-chevron-left"></i>
        </button>
        <button class="exit-button" style="width: 40px;" onclick="toggleMainMenu('');">
            <i class="fa-solid fa-times"></i>
        </button>
</div>
    <div style="margin-top: 10px;">
        <p style="margin-bottom: 10px; font-weight: bold; font-size: 16px;">Weather Radio Settings</p>
        <button id="toggle-weather-radio" class="submenu-button" onclick="toggleWeatherRadio();">
            <i class="fas fa-radio"></i> Toggle Stations
        </button>
        <p>Toggle the display of weather radio stations on the map. Stations are provided by <a href="https://weatherradio.org" target="_blank">GWES WeatherRadio</a> from participating contributors.</p>
    </div>
</div>



   <!-- Info menu -->
<div id="info-menu">
    <div class="menu-header">
        <span><i class="fa-solid fa-info-circle"></i> Info</span>
        <button class="exit-button" onclick="toggleMainMenu('')">
            <i class="fa-solid fa-times"></i>
        </button>
    </div>
    <div id="info-content">
        <button class="menu-button" onclick="toggleSubMenu('general-info')">
            <i class="fa-solid fa-info-circle"></i> General Info <i class="fa-solid fa-chevron-right"></i>
        </button>
        <button class="menu-button" onclick="toggleSubMenu('updates-info')">
            <i class="fa-solid fa-arrow-rotate-right"></i> Updates <i class="fa-solid fa-chevron-right"></i>
        </button>
    </div>
</div>

<!-- Add new Updates submenu -->
<div id="updates-info">
    <div class="menu-header">
        <button class="back-button" style="width: 40px;" onclick="returnToInfoMenu();">
            <i class="fa-solid fa-chevron-left"></i>
        </button>
        <button class="exit-button" style="width: 40px;" onclick="toggleMainMenu('');">
            <i class="fa-solid fa-times"></i>
        </button>
    </div>
    <div style="margin-top: 10px;">
        <p style="text-align: center; font-size: 18px;"><b>Latest Updates</b></p>
        <p><b>General Information</b></p>
        <p>Version: 1.5.0</p>
        <p>Build Number: 52</p>

        <p><b>Update Log</b></p>
        <p>Version 1.5.0: A few more updates! We added Potential Disturbance Areas to the radar! We also gave the UI a small refresh, and even added an Animation Speed toggle! - 11/10/2024</p>
        <p>Version 1.4.0: Another big update! We just added the ability to listen to over 40 NOAA Weather Radio stations on the radar! We also added an alert list and fixed a few bugs! - 11/10/2024</p>
        <p>Version 1.3.0: More features! We added Mesoscale Discussions to the radar, as well as changing Map Type and Storm Report settings too. - 10/30/2024</p>
        <p>Version 1.2.0: New features incoming! We added real-time lightning strikes, changed our alert & watch color schemes, and improved performance by a ton! - 10/17/2024</p>
        <p>Version 1.1.8: Another small update! We just added the ability to read out an alert on the radar! As always, we fixed a few bugs as well. - 10/14/2024</p>
        <p>Version 1.1.7: More updates! We just added Special Marine and Extreme Wind Warnings to the radar! We also squashed a few bugs too. - 10/10/2024</p>
        <p>Version 1.1.6: Another radar update! We refreshed our hurricane icons, made some performance updates, and fixed some bugs as well. - 10/7/2024</p>
        <p>Version 1.1.5: New features and bug fixes! We just added hurricane tracks and data into the radar as well as a few bug fixes. - 9/30/2024</p>
        <p>Version 1.1.0: Another update? You bet! We just integrated SPC Outlooks into the radar as well as a new map type we're calling Deep Dark Mode. - 8/20/2024</p>
        <p>Version 1.0.5: New feature! We just added real-time tornado, wind, and hail reports to the radar! We also fixed a few bugs as well. - 8/15/2024</p>
        <p>Version 1.0.0: Radar released! Current features include radar, near-instant alerts, watches, map types, and (a lot of) customization! - 8/10/2024</p>
    </div>
</div>

<!-- General Info submenu -->
<div id="general-info">
    <div class="menu-header">
        <button class="back-button" style="width: 40px;" onclick="returnToInfoMenu();">
            <i class="fa-solid fa-chevron-left"></i>
        </button>
        <button class="exit-button" style="width: 40px;" onclick="toggleMainMenu('');">
            <i class="fa-solid fa-times"></i>
        </button>
    </div>
    <div style="margin-top: 10px;">
        <p><b>About Us</b></p>
        <p>West Georgia Weather, part of TCL Media Group, provides local and national weather alerts to protect lives and property during severe weather events!</p>
        
        <p><b>Our Sponsors</b></p>
        <p>â€¢ Maglite</p>
        <p>â€¢ Talk2me</p>
        
        <p><b>Contact</b></p>
        <p>Questions? Email us at: david.westgaweather@gmail.com</p>
    </div>
</div>

<!-- Attributions submenu -->
<div id="attributions">
    <div class="menu-header">
        <button class="back-button" style="width: 40px;" onclick="toggleMainMenu('info-menu');"><i class="fa-solid fa-chevron-left"></i></button>
        <button class="exit-button" style="width: 40px;" onclick="toggleMainMenu('');"><i class="fa-solid fa-times"></i></button>
    </div>
    <div style="margin-top: 10px;">
        <p><b> Main Attributions</b></p>
        <div style="height: 0px;"></div>
        <p>Built for: <a href="https://xtremewx.com/" target="_blank">Xtreme Weather Discord</a> by <a href="https://xtremewx.com/author/wxtership" target="_blank">@wxtership</a></p>
<p>Made possible by: <a href="https://x.com/busybird150" target="_blank">BusyBird15</a> & <a href="https://busybird15.github.io/radar" target="_blank">The Weather Team</a></p>
<p><b> Other Attributions</b></p>
        
        <p>Map Tiles: <a href="https://leafletjs.com" target="_blank">Leaflet</a> & <a href="https://www.maptiler.com" target="_blank">MapTiler</a></p>
        <p>Radar Tiles: <a href="https://rainviewer.com/api.html" target="_blank">RainViewer</a></p>
        <p>Warnings: <a href="https://www.weather.gov/documentation/services-web-api#/" target="_blank">NWS API</a></p>
        <p>Watches: <a href="https://www.mesonet.agron.iastate.edu/request/gis/spc_watch.phtml" target="_blank">IEM WW Archive</a></p>
        <p>Discussions: <a href="https://mapservices.weather.noaa.gov/vector/rest/services/outlooks/spc_mesoscale_discussion/MapServer" target="_blank">ESRI & SPC</a></p>
        <p>Hurricanes: <a href="https://esri-disasterresponse.hub.arcgis.com/maps/248e7b5827a34b248647afb012c58787/about" target="_blank">ESRI & NHC</a></p>
 <p>Disturbances: <a href="https://mapservices.weather.noaa.gov/tropical/rest/services/tropical/NHC_tropical_weather/MapServer" target="_blank">ESRI & NHC</a></p>
 <p>Reports: <a href="https://www.spc.noaa.gov/climo/reports/" target="_blank">SPC Reports Archive</a></p>
 <p>Outlooks: <a href="https://www.spc.noaa.gov/gis/" target="_blank">SPC GIS Portal</a></p>
<p>Radio: <a href="https://weatherradio.org" target="_blank">GWES WeatherRadio</a></p>
    </div>
</div>

    

    <div id="mapid" style="border-radius: 5px; position: absolute; top: 10px; left: 10px; bottom: 10px; right: 10px;"></div>

<!-- Update the sponsor logo with new image URL -->
<div id="sponsor-logo">
    <a href="https://wgtv.com" target="_blank">
        <img src="https://imgur.com/1yg7pPb.png" alt="WGTV" title="West Georgia TV">
    </a>
</div>

<div id="alert-popup" class="alert-popup">
    <div class="popup-header">
        <div class="popup-header-title" id="popup-title">Alert Title</div>
        <button onclick="closeAlertPopup()"><i class="fa-solid fa-times"></i></button>
    </div>
    <p id="popup-details"></p>
    <p id="popup-hazards-impacts"></p>
    <p id="popup-description" style="margin-bottom: 10px;"></p>
    <p id="popup-action"></p>
   <!-- Full-width Play/Pause button -->
<button id="play-pause-btn" onclick="toggleListen()" style="width: 100%; height: 40px; border-radius: 10px; background-color: #636381; color: white; border: 2px solid white; display: flex; align-items: center; justify-content: center; font-size: 18px;">
    <i class="fa-solid fa-volume-up" style="margin-right: 8px;"></i> Play Alert
</button>
 </div>
    
    <div>
      <div id="watch-popup" class="alert-popup">
        <div class="popup-header">
            <div class="popup-header-title" id="watch-popup-title">Watch Title</div>
            <button onclick="closeWatchPopup()"><i class="fa-solid fa-times"></i></button>
        </div>
        <p id="watch-popup-details"></p>
        <p id="watch-popup-probabilities"></p>
    </div>
</div>

<div id="dbz-meter">
    <img src="https://imgur.com/DSJhn45.png" alt="DBZ Scale" title="Radar DBZ Scale">
</div>

<!-- Alert List Button -->
<div id="alert-list-button-container">
    <button id="alert-list-button" onclick="toggleAlertListMenu();">
        <i class="fa-solid fa-triangle-exclamation"></i>
    </button>
</div>

<!-- Alert List Menu -->
<div id="alert-list-menu">
    <div class="menu-header">
        <p class="menu-title">Active Weather Alerts</p>
        <button class="exit-button" onclick="toggleAlertListMenu();">
            <i class="fa-solid fa-times"></i>
        </button>
    </div>
    <div id="no-alerts-message" style="display: none; text-align: center; padding: 20px;">
        <i class="fa-solid fa-triangle-exclamation"></i>
        <p>No active alerts</p>
    </div>
    <ul id="alert-log"></ul>
</div>

<script src="script.js"></script>

<script>
function toggleMainMenu(menuId) {
    // Get all menus
    const menus = document.querySelectorAll('[id$="-settings"], [id$="-menu"], [id$="-info"]');
    
    if (menuId === '') {
        // Only hide menus when explicitly closing
        menus.forEach(menu => menu.classList.remove('active'));
        return;
    }
    
    const selectedMenu = document.getElementById(menuId);
    if (selectedMenu) {
        if (selectedMenu.classList.contains('active')) {
            // If menu is already active, close it
            selectedMenu.classList.remove('active');
        } else {
            // Hide other menus and show selected one
            menus.forEach(menu => menu.classList.remove('active'));
            selectedMenu.classList.add('active');
        }
    }
}

function toggleSubMenu(menuId, action = 'show') {
    const layersMenu = document.getElementById('layers-menu');
    const subMenu = document.getElementById(menuId);
    
    if (action === 'back') {
        subMenu.classList.remove('active');
        layersMenu.classList.add('active');
    } else {
        if (subMenu.classList.contains('active')) {
            subMenu.classList.remove('active');
            layersMenu.classList.add('active');
        } else {
            layersMenu.classList.remove('active');
            subMenu.classList.add('active');
        }
    }
}

function returnToInfoMenu() {
    const updatesInfo = document.getElementById('updates-info');
    const generalInfo = document.getElementById('general-info');
    const infoMenu = document.getElementById('info-menu');

    updatesInfo.classList.remove('active');
    generalInfo.classList.remove('active');
    infoMenu.classList.add('active');
}

// Placefile functions remain the same
let activePlacefiles = new Map();

function addPlacefile() {
    const url = document.getElementById('placefile-url').value.trim();
    if (!url) return;
    
    if (!activePlacefiles.has(url)) {
        // Create a unique ID for this placefile
        const id = 'placefile-' + Date.now();
        
        // Add to active place files map
        activePlacefiles.set(url, {
            id: id,
            layer: null
        });
        
        // Add to UI list
        const listDiv = document.getElementById('placefile-list');
        const placefileItem = document.createElement('div');
        placefileItem.style.display = 'flex';
        placefileItem.style.justifyContent = 'space-between';
        placefileItem.style.alignItems = 'center';
        placefileItem.style.marginBottom = '10px';
        placefileItem.innerHTML = `
            <span style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 80%;">${url}</span>
            <button onclick="removePlacefile('${url}')" style="background: none; border: none; color: #ff4444; cursor: pointer;">
                <i class="fa-solid fa-trash"></i>
            </button>
        `;
        listDiv.appendChild(placefileItem);
        
        // Load the placefile
        loadPlacefile(url);
    }
    
    // Clear input
    document.getElementById('placefile-url').value = '';
}

function removePlacefile(url) {
    const placefile = activePlacefiles.get(url);
    if (placefile) {
        if (placefile.layer) {
            map.removeLayer(placefile.layer);
        }
        activePlacefiles.delete(url);
        
        // Remove from UI
        const listDiv = document.getElementById('placefile-list');
        const items = listDiv.children;
        for (let i = 0; i < items.length; i++) {
            if (items[i].textContent.includes(url)) {
                listDiv.removeChild(items[i]);
                break;
            }
        }
    }
}

function loadPlacefile(url) {
    // Use CORS proxy for Spotter Network feed
    const corsProxy = 'https://corsproxy.io/?';
    const fetchUrl = url.includes('spotternetwork.org') ? corsProxy + encodeURIComponent(url) : url;
    
    fetch(fetchUrl)
        .then(response => response.text())
        .then(data => {
            console.log('Received placefile data:', data.substring(0, 200)); // Debug first 200 chars
            const placefile = activePlacefiles.get(url);
            if (placefile) {
                // Remove existing layer if it exists
                if (placefile.layer) {
                    map.removeLayer(placefile.layer);
                }
                
                const layer = L.layerGroup().addTo(map);
                placefile.layer = layer;
                
                let markersAdded = 0;
                const lines = data.split('\n');
                
                lines.forEach(line => {
                    line = line.trim();
                    if (!line || line.startsWith(';')) return;
                    
                    const parts = line.split('|');
                    if (parts.length < 2) return;
                    
                    switch (parts[0].toUpperCase()) {
                        case 'P':
                            if (parts.length >= 4) {
                                const lat = parseFloat(parts[1]);
                                const lon = parseFloat(parts[2]);
                                
                                if (!isNaN(lat) && !isNaN(lon)) {
                                    const marker = L.circleMarker([lat, lon], {
                                        radius: 6,
                                        color: '#FF0000',
                                        fillColor: '#FF0000',
                                        fillOpacity: 0.8,
                                        weight: 2
                                    }).addTo(layer);
                                    
                                    if (parts[4]) {
                                        marker.bindPopup(parts[4]);
                                    }
                                    
                                    markersAdded++;
                                }
                            }
                            break;
                    }
                });
                
                console.log(`Added ${markersAdded} spotter markers`); // Debug marker count
                
                if (markersAdded > 0) {
                    const bounds = layer.getBounds();
                    if (bounds.isValid()) {
                        map.fitBounds(bounds);
                    }
                }
            }
        })
        .catch(error => {
            console.error('Error loading placefile:', error);
            const listDiv = document.getElementById('placefile-list');
            const errorDiv = document.createElement('div');
            errorDiv.style.color = '#ff4444';
            errorDiv.textContent = 'Error loading placefile. Retrying...';
            listDiv.appendChild(errorDiv);
            setTimeout(() => errorDiv.remove(), 5000);
            
            // Auto-retry once after 2 seconds
            setTimeout(() => loadPlacefile(url), 2000);
        });
}
</script>
</body>
</html>